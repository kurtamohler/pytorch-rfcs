# PyTorch Logging System

## **Summary**
Create a message logging system for PyTorch with the following requirements:

* All errors, warnings, and other messages generated by PyTorch should be
  emitted using the the logging system API

* The APIs for emitting messages and changing settings should all be consistent
  between C++ and Python

* Offer different message severity levels, including at least the following:

  - **Info**: Emits a message without creating a warning or error. By default,
    this gets printed to stdout

  - **Warning**: Emits a message as a warning. By default, this will turn into
    a Python warning

  - **Error**: Emits a message as an error. By default, this will turn into
    a Python error

  - TODO: Should we also have a **Fatal** severity for integration with
    Meta's internal logging system? A fatal message terminates the program

* Offer different classes of messages, including at least the following:

  - **Default**: A catch-all message class

  - **Nondeterministic**: Emitted when `torch.use_deterministic_algorithms(True)`
    is set and a nondeterministic operation is called

  - **Deprecated**: Emitted when a deprecated function is called

  - **Beta**: Emitted when a beta feature is called. See
    [PyTorch feature classifications](https://pytorch.org/blog/pytorch-feature-classification-changes/)

  - **Prototype**: Emitted when a prototype feature is called. See
    [PyTorch feature classifications](https://pytorch.org/blog/pytorch-feature-classification-changes/)

  - TODO: Should all the classic Python errors and warnings (`TypeError`,
    `ValueError`, `NotImplementedError`, `DeprecationWarning`, etc) have their
    own message class? Or are those separate from our concept of a message
    class, and any message class is allowed to raise any Python exception or
    warning type?

* Continue using warning/error APIs that currently exist in PyTorch wherever
  possible. For instance, `TORCH_CHECK`, `TORCH_WARN`, and `TORCH_WARN_ONCE`
  should continue to be used in C++

  - NOTE: These existing APIs don't currently have a concept of message classes,
    so that will need to be added

* Creating new message classes and severity levels should be easy

* Ability to turn warnings into errors. This is already possible with the
  Python `warnings` module filter, but the PyTorch docs should mention it and
  we should probably have unit tests for it.
  See [documentation](https://docs.python.org/3/library/warnings.html#the-warnings-filter)

* Settings to disable specific message classes and severity levels

  - TODO: Most errors should not be disableable, right? Perhaps only
    some message classes should allow disabling or downgrading errors. For
    instance, currently in PyTorch, we can downgrade a nondeterministic error
    to a warning, but we wouldn't want to downgrade an error from invalid
    arguments given to an operation.

  - Disabling warnings in Python should already be possible with the `warnings`
    module filter. See [documentation](https://docs.python.org/3/library/warnings.html#the-warnings-filter).
    There is no similar system in C++ at the moment, and building one is probably
    low priority.

  - Filtering out **Info** severity messages would also be nice to have, since
    excessive printouts can degrade the user experience. Related to
    issue [#68768](https://github.com/pytorch/pytorch/issues/68768)

* Settings to avoid emitting duplicate messages generated by multiple
  `torch.distributed` ranks. Related to issue
  [#68768](https://github.com/pytorch/pytorch/issues/68768)

* Ability to make a particular warning only warn once. Warn-once should be the
  default in most cases.

  - NOTE: Currently `TORCH_WARN_ONCE` does this in C++, but there is no Python
    equivalent

  - TODO: Should there be a setting to turn a warn-once into a warn-always for
    a given message class and vice versa?

* Settings can be changed from Python, C++, or environment variables

  - Filtering warnings with Python command line arguments should
    remain possible. For instance, the following turns a `DeprecationWarning`
    into an error: `python -W error::DeprecationWarning your_script.py`

* Should integrate with Meta's internal logging system, which is
  [glog](https://github.com/google/glog)

  - TODO: What are all the requirements that define "integrating with glog"

* Must be OSS-friendly, so it shouldn't require libraries (like glog) which may
  cause incompatibility issues for projects that use PyTorch

* TODO: Determine the requirements for the following concepts:

  - Log files (default behavior and any settings)


## **Motivation**
Original issue: [link](https://github.com/pytorch/pytorch/issues/72948)

Currently, it is challenging for PyTorch developers to provide messages that
act consistently between Python and C++.

It is also challenging for PyTorch users to manage the messages that PyTorch
emits. For instance, if a PyTorch user happens to be calling PyTorch functions
that emit lots of messages, it can be difficult for them to filter out those
messages so that their project's users don't get bombarded with warnings that
they don't need to see.
